{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\mrk80\\\\Documents\\\\dev\\\\java_project\\\\news-summary-frontend\\\\news-summary-frontend\\\\src\\\\pages\\\\ChargeSuccess.jsx\",\n  _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from \"react\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { apiFetch } from \"../api/client\";\nimport { useAuth } from \"../context/AuthContext\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction ChargeSuccess() {\n  _s();\n  const {\n    search,\n    pathname\n  } = useLocation();\n  const nav = useNavigate();\n  const {\n    isChecking,\n    isLoggedIn,\n    refreshBalance\n  } = useAuth();\n  const qs = new URLSearchParams(search);\n  const paymentKey = qs.get(\"paymentKey\");\n  const orderId = qs.get(\"orderId\");\n  const amount = Number(qs.get(\"amount\"));\n  const [status, setStatus] = useState(\"processing\");\n  const [errorCode, setErrorCode] = useState(\"\");\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const [coins, setCoins] = useState(null);\n  const calledRef = useRef(false);\n  useEffect(() => {\n    if (calledRef.current) return;\n    if (isChecking) return;\n    if (!isLoggedIn) {\n      nav(`/login?returnUrl=${encodeURIComponent(pathname + search)}`, {\n        replace: true\n      });\n      return;\n    }\n    calledRef.current = true;\n    (async () => {\n      try {\n        var _res$grantedCoins;\n        if (!paymentKey || !orderId || !Number.isFinite(amount)) {\n          throw new Error(\"잘못된 접근입니다.\");\n        }\n        const res = await apiFetch(\"/api/payments/confirm\", {\n          method: \"POST\",\n          body: JSON.stringify({\n            paymentKey,\n            orderId,\n            amount\n          })\n        });\n        setStatus(\"done\");\n        setCoins((_res$grantedCoins = res === null || res === void 0 ? void 0 : res.grantedCoins) !== null && _res$grantedCoins !== void 0 ? _res$grantedCoins : 0);\n        await refreshBalance();\n      } catch (e) {\n        var _e$response, _e$response2, _e$response2$data;\n        console.error(\"결제 승인 실패:\", e);\n        const status = (e === null || e === void 0 ? void 0 : e.status) || (e === null || e === void 0 ? void 0 : (_e$response = e.response) === null || _e$response === void 0 ? void 0 : _e$response.status);\n        const msg = (e === null || e === void 0 ? void 0 : e.message) || (e === null || e === void 0 ? void 0 : (_e$response2 = e.response) === null || _e$response2 === void 0 ? void 0 : (_e$response2$data = _e$response2.data) === null || _e$response2$data === void 0 ? void 0 : _e$response2$data.message);\n        setErrorCode(status !== null && status !== void 0 ? status : \"UNKNOWN\");\n        setErrorMessage(msg !== null && msg !== void 0 ? msg : \"결제 승인에 실패했습니다.\");\n        setStatus(\"error\");\n      }\n    })();\n  }, [isChecking, isLoggedIn, paymentKey, orderId, amount, nav, pathname, search, refreshBalance]);\n  if (status === \"processing\") {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: 24\n      },\n      children: \"\\uACB0\\uC81C \\uC2B9\\uC778 \\uC911...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 16\n    }, this);\n  }\n  if (status === \"error\") {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: 24,\n        color: \"#b30000\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"\\uACB0\\uC81C \\uC2E4\\uD328\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 17\n      }, this), errorCode && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: [\"\\uC5D0\\uB7EC \\uCF54\\uB4DC: \", errorCode]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 31\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: errorMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => nav(\"/charge\"),\n        style: {\n          marginTop: 12\n        },\n        children: \"\\uB2E4\\uC2DC \\uC2DC\\uB3C4\\uD558\\uAE30\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 67,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 13\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      \"justify-content\": \"center\",\n      \"align-items\": \"center\",\n      \"text-align\": \"center\",\n      padding: 24\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\uACB0\\uC81C \\uC131\\uACF5\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [\"\\uCF54\\uC778 \", coins !== null && coins !== void 0 ? coins : 0, \"\\uAC1C\\uAC00 \\uCDA9\\uC804\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4.\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      className: \"home-button\",\n      onClick: () => nav(\"/\"),\n      children: \"Home\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 9\n  }, this);\n}\n_s(ChargeSuccess, \"20tPYqwkTNBO7RxTxs8uAZCoKGg=\", false, function () {\n  return [useLocation, useNavigate, useAuth];\n});\n_c = ChargeSuccess;\nexport default ChargeSuccess;\nvar _c;\n$RefreshReg$(_c, \"ChargeSuccess\");","map":{"version":3,"names":["useEffect","useRef","useState","useLocation","useNavigate","apiFetch","useAuth","jsxDEV","_jsxDEV","ChargeSuccess","_s","search","pathname","nav","isChecking","isLoggedIn","refreshBalance","qs","URLSearchParams","paymentKey","get","orderId","amount","Number","status","setStatus","errorCode","setErrorCode","errorMessage","setErrorMessage","coins","setCoins","calledRef","current","encodeURIComponent","replace","_res$grantedCoins","isFinite","Error","res","method","body","JSON","stringify","grantedCoins","e","_e$response","_e$response2","_e$response2$data","console","error","response","msg","message","data","style","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","color","onClick","marginTop","className","_c","$RefreshReg$"],"sources":["C:/Users/mrk80/Documents/dev/java_project/news-summary-frontend/news-summary-frontend/src/pages/ChargeSuccess.jsx"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport { apiFetch } from \"../api/client\";\r\nimport { useAuth } from \"../context/AuthContext\";\r\n\r\nfunction ChargeSuccess() {\r\n    const { search, pathname } = useLocation();\r\n    const nav = useNavigate();\r\n    const { isChecking, isLoggedIn, refreshBalance } = useAuth();\r\n\r\n    const qs = new URLSearchParams(search);\r\n    const paymentKey = qs.get(\"paymentKey\");\r\n    const orderId = qs.get(\"orderId\");\r\n    const amount = Number(qs.get(\"amount\"));\r\n\r\n    const [status, setStatus] = useState(\"processing\");\r\n    const [errorCode, setErrorCode] = useState(\"\");\r\n    const [errorMessage, setErrorMessage] = useState(\"\");\r\n    const [coins, setCoins] = useState(null);\r\n    const calledRef = useRef(false);\r\n\r\n    useEffect(() => {\r\n        if (calledRef.current) return;\r\n        if (isChecking) return;\r\n        if (!isLoggedIn) {\r\n            nav(`/login?returnUrl=${encodeURIComponent(pathname + search)}`, {replace: true});\r\n            return;\r\n        }\r\n\r\n        calledRef.current = true;\r\n        (async () => {\r\n            try {\r\n                if (!paymentKey || !orderId || !Number.isFinite(amount))  {\r\n                    throw new Error(\"잘못된 접근입니다.\");\r\n                }\r\n\r\n                const res = await apiFetch(\"/api/payments/confirm\", {\r\n                    method: \"POST\",\r\n                    body: JSON.stringify({ paymentKey, orderId, amount }),\r\n                });\r\n\r\n                setStatus(\"done\");\r\n                setCoins(res?.grantedCoins ?? 0);\r\n\r\n                await refreshBalance();\r\n            } catch (e) {\r\n                console.error(\"결제 승인 실패:\", e);\r\n                const status = e?.status || e?.response?.status;\r\n                const msg = e?.message || e?.response?.data?.message;\r\n                setErrorCode(status ?? \"UNKNOWN\");\r\n                setErrorMessage(msg ?? \"결제 승인에 실패했습니다.\");\r\n                setStatus(\"error\");\r\n            }\r\n        })();\r\n    }, [isChecking, isLoggedIn, paymentKey, orderId, amount, nav, pathname, search, refreshBalance]);\r\n\r\n    if (status === \"processing\") {\r\n        return <div style={{ padding: 24 }}>결제 승인 중...</div>\r\n    }\r\n\r\n    if (status === \"error\") {\r\n        return (\r\n            <div style={{ padding: 24, color: \"#b30000\"}}>\r\n                <h2>결제 실패</h2>\r\n                {errorCode && <p>에러 코드: {errorCode}</p>}\r\n                <p>{errorMessage}</p>\r\n                <button onClick={() => nav(\"/charge\")} style={{ marginTop: 12 }}>\r\n                    다시 시도하기\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div style={{ \"justify-content\": \"center\", \"align-items\": \"center\", \"text-align\": \"center\", padding: 24 }}>\r\n            <h2>결제 성공</h2>\r\n            <br />\r\n            <p>코인 {coins ?? 0}개가 충전되었습니다.</p>\r\n            <br />\r\n            <button className=\"home-button\" onClick={() => nav(\"/\")}>Home</button>\r\n        </div>\r\n    );\r\n}\r\nexport default ChargeSuccess;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}